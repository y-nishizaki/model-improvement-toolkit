# メトリクス計算機能 要件仕様書

**作成日**: 2025-07-20
**最終更新**: 2025-07-20
**ステータス**: Implemented

## 機能概要
分類・回帰タスクに対する包括的なメトリクス計算を提供し、モデルの性能を定量的に評価する機能。

## ユーザーストーリー

### US-ME-001: 自動タスク検出 ✅
**As a** データサイエンティスト
**I want** タスクタイプを自動で検出してメトリクスを計算する
**So that** 手動でタスクタイプを指定する必要がない

**受け入れ基準:**
- GIVEN 真値と予測値
- WHEN calculate_metrics(y_true, y_pred, task_type="auto")を実行
- THEN タスクタイプが自動検出され適切なメトリクスが計算される

### US-ME-002: 分類メトリクス ✅
**As a** データサイエンティスト
**I want** 分類タスクの包括的なメトリクスを取得する
**So that** モデルの分類性能を多角的に評価できる

**受け入れ基準:**
- GIVEN 分類タスクの真値と予測値
- WHEN メトリクス計算を実行
- THEN 以下が計算される
  - accuracy, precision, recall, f1
  - 混同行列の要素（TP, TN, FP, FN）
  - AUC（確率予測の場合）

### US-ME-003: 回帰メトリクス ✅
**As a** データサイエンティスト
**I want** 回帰タスクの包括的なメトリクスを取得する
**So that** モデルの回帰性能を評価できる

**受け入れ基準:**
- GIVEN 回帰タスクの真値と予測値
- WHEN メトリクス計算を実行
- THEN 以下が計算される
  - MSE, RMSE, MAE, R2
  - 残差統計（平均、標準偏差、最大誤差）
  - MAPE（ゼロ値処理付き）

## 機能仕様

### 実装済み機能 ✅
1. **calculate_metrics()** (core/metrics.py)
   - 自動タスク検出（分類/回帰/確率）
   - 統一インターフェース
   - エラーハンドリング

2. **分類メトリクス**
   - 二値分類: precision, recall, f1, 混同行列
   - 多クラス分類: マクロ/マイクロ平均、クラス別メトリクス
   - 確率予測: AUC, log_loss, 最適閾値

3. **回帰メトリクス**
   - 基本: MSE, RMSE, MAE, R2
   - 残差分析: 平均、標準偏差、最大誤差
   - パーセンテージ誤差: MAPE（ゼロ値処理）

### 未実装機能 🔲
1. **カスタムメトリクス登録**
2. **重み付きメトリクス**
3. **時系列メトリクス**

## 技術仕様
- **入力形式**: numpy配列、pandas Series/DataFrame
- **タスク検出**: 値の範囲、離散性、次元から自動判定
- **エラー処理**: 長さ不一致、空配列、無効なタスクタイプ

## 依存関係
- **scikit-learn**: メトリクス計算の基盤 ✅
- **統合先**: 全てのAnalyzerクラス